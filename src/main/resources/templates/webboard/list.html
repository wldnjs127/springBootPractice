<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout1}">
<head>
<meta charset="UTF-8">
<title>나홀로집에</title>
	<style>
		@font-face {
		    font-family: 'Yeongdo-Rg';
		    src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2202-2@1.0/Yeongdo-Rg.woff') format('woff');
		    font-weight: normal;
		    font-style: normal;
		}
		
		*{
		 	 font-family: 'Yeongdo-Rg';
		}
		
		table,th,tr,td{
			margin-top : 30px;
			padding : 10px;
			border : 1px solid;
			border-collapse : collapse;
		}
		.hotpink{
			color: white;
			background-color: red;
		}
		
		.skyblue{
			color: white;
			background-color: green;
		}
		.first{
		        color: gold;
		    }
		.last{
		       color: silver;
		   }
		
		 .pagination li{
		 	margin-top : 15px;
		 	padding: 10px;
		 	font-size: 15px;
		 }
	
	</style>
</head>
<body>
    <!-- 하위 HTML에서 content 재정의할 예정 -->
    <div class="panel panel-default" layout:fragment="content">
    <p>[[${message}]]</p>
    <p><a th:href="@{insert.do}">게시글 작성</a></p>
    <div class="pull-left">
	    <select id="searchType">
	     <option>전체</option>
	     <option value="title" th:selected="${pageVO.type=='title'}">제목</option>
	     <option value="content" th:selected="${pageVO.type=='content'}">내용</option>
	     <option value="writer" th:selected="${pageVO.type=='writer'}">작성자</option>
	    </select>
  		<input type="text" id="searchKeyword" th:value="${pageVO.keyword}">
  		<button id="searchBtn">조건검색</button>
  		<img alt="이미지" th:src="@{/images/homeAlone.webp}" width="50px" height="60px">
	</div>

<p>[[${resultMessage}]]</p>
    
    
    <hr>
       <table>
		<tr>
			<th>bno</th>
			<th>title</th>
			<th>writer</th>
			<th>content</th>
			<th>regdate</th>
			<th>updatedate</th>
			<th>replies</th>
			<th></th>
			<th>delete</th>
		</tr>
		<tr th:each="board,status2:${blist.result.content}" th:class="${status2.even?'hotpink':'skyblue'}">
		<!--/* ${board.replies.size}로 하면 여러번 불러오므로 lists로 해야한다 */-->
			<td th:text="|${board.bno} ${#lists.size(board.replies)}|"></td>
			<td th:text="${board.title}"></td>
			<td th:text="${board.writer}"></td>
			<td th:text="${board.content}"></td>
			<td th:text="${board.regdate}"></td>
			<td th:text="${board.updatedate}"></td>
			<td><p th:text="${#lists.size(board.replies)}"></p></td>
			<td><a th:href="@{/webboard/detail.do(bno=${board.bno},page=${pageVO.page},size=${pageVO.size},type=${pageVO.type},keyword=${pageVO.keyword})}">바로가기</a></td>
			<td><a th:href="@{/webboard/delete.do(bno=${board.bno})}">삭제하기</a></td>
		</tr>
		</table>
		<!-- paging -->
		  <nav>
		   <div class="paging-container">
		     <ul class="pagination">
		       <li class="page-item" th:if="${blist.prevPage}">
		         <a th:href="${blist.prevPage.pageNumber}+1">PREV [[${blist.prevPage.pageNumber}+1]]</a>
		       </li>
		        <li class="page-item" th:classappend="${p.pageNumber==blist.currentPageNum-1}?active:''" 
		                             th:each="p:${blist.pageList}">
		         <a th:href="${p.pageNumber}+1">[[${p.pageNumber}+1]]</a>
		       </li>  
		       <li class="page-item" th:if="${blist.nextPage}">
		         <a th:href="${blist.nextPage.pageNumber}+1">NEXT [[${blist.nextPage.pageNumber}+1]]</a>
		       </li>   
		     </ul>
		   </div>
		  </nav>
		  <form id="f1" th:action="@{/webboard/list.do}" method="get">
		    <input type="hidden" name="page" th:value="${blist.currentPageNum}">
		    <input type="hidden" name="size" th:value="${blist.currentPage.pageSize}">
		    <input type="hidden" name="type" th:value="${pageVO.type}">
		    <input type="hidden" name="keyword" th:value="${pageVO.keyword}">
		  </form>
    </div>
    <th:block layout:fragment="script1">
    	<script th:inline="javascript">
    		var message = eval('[[${message}]]');
    		console.log(message);
    		if(message!=null){
    			console.log('1223',message);
    			alert(message);
    		}
    		
			var formObj = $("#f1");
			$(".pagination a").click(function(e){
			e.preventDefault();
			formObj.find("[name='page']").val($(this).attr('href'));
			formObj.attr("action", "/webboard/list.do");
			formObj.submit();
			});
			
			$("#searchBtn").click(function(){
				var typeStr = $("#searchType").find(":selected").val();
				var keywordStr = $("#searchKeyword").val();
				formObj.find("[name='type']").val(typeStr);
				formObj.find("[name='keyword']").val(keywordStr);
				formObj.find("[name='page']").val(1);
				formObj.submit();
			});
			$(".boardLink").click(function(e){
				e.preventDefault();
				var boardNo = $(this).attr("href");
				alert(boardNo);
				formObj.attr("action", "/boards/view");  
				formObj.append("<input type='hidden' name='bno' value='"+boardNo+"'>");
				formObj.submit();
			});
			
			
    	</script>
    </th:block>
</body>
</html>